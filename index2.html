<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>My first three.js app</title>
    <style>
        body { margin: 0; }
    </style>
</head>
<body>
<div id="console">

</div>
<canvas id="test"></canvas>
<script src="js/three.js"></script>
<script>
    const canvas = document.querySelector('#test');
    const cons = document.querySelector('#console')
    const mouse = new THREE.Vector2();
    const raycaster = new THREE.Raycaster();

    const renderer = new THREE.WebGLRenderer({
        canvas: canvas,
        alpha: true,
        antialias: true
    });
    const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.position.z = 5;


    const scene = new THREE.Scene();

    const geometry = new THREE.PlaneGeometry(20, 20);
    const material = new THREE.MeshBasicMaterial({
        color: 0x333333
    });
    const backplane = new THREE.Mesh(geometry, material);
    const amblight = new THREE.AmbientLight(0xffffff);

    scene.add(amblight);
    // scene.add(backplane);

    //Drawing the shape, normally this is done with the mouse position
    const shape = new THREE.Shape();
    shape.moveTo(1, 1, 1);
    shape.lineTo(1, 0, 1);
    shape.lineTo(0, 0, 1);
    shape.lineTo(0, 1, 1);
    shape.lineTo(1, 1, 1);

    const shapeGeo = new THREE.ShapeGeometry(shape);
    const shapeMat = new THREE.MeshBasicMaterial({
        wireframe: true, color: "black"
    });
    const shapeMesh = new THREE.Mesh(shapeGeo, shapeMat)

    scene.add(shapeMesh);

    renderer.render(scene, camera);

    function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
    }
    animate()

    function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
    }

    function mouseController(event, type) {
        event.preventDefault();
        mouse.x = (event.layerX / canvas.width) * 2 - 1;
        mouse.y = -(event.layerY / canvas.height) * 2 + 1;
        raycaster.setFromCamera(mouse.clone(), camera);
        let pos = raycaster.intersectObject(shapeMesh, true);

        //console.log(pos)
        if (pos[0]) {
            switch (type) {
                case 'mousedown':
                    cons.innerHTML += "HIT!";
                    console.log(shapeMesh)
                    const middlex = shapeMesh.geometry.boundingSphere.center.x ;
                    //const middley = (shapeMesh.geometry.boundingBox.max.y + shapeMesh.geometry.boundingBox.min.y) / 2;
                    shapeMesh.position.x = pos[0].point.x-middlex;
                    shapeMesh.position.y = pos[0].point.y-middlex;
                    break;
            }
        }

    }
    window.addEventListener('resize', onWindowResize, false);
    canvas.addEventListener('mousedown', (e) => {
        mouseController(e, 'mousedown')
    }, false);
</script>
</body>
</html>